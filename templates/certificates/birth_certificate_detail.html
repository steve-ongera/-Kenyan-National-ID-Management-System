{% extends 'base/base.html' %}
{% load static %}

{% block title %}Birth Certificate {{ certificate.certificate_number }} - National ID Management System{% endblock %}

{% block content %}
<div class="message-container" id="system-messages">
    {% for message in messages %}
    <div class="alert alert-{{ message.tags }} alert-dismissible fade show">
        <i class="bi {% if message.tags == 'success' %}bi-check-circle{% else %}bi-exclamation-triangle{% endif %} me-2"></i>
        {{ message }}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
    {% endfor %}
</div>

<div class="pagetitle">
    <h1><i class="bi bi-award me-2"></i>Birth Certificate Details</h1>
    <nav>
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="#"><i class="bi bi-house-door"></i> Home</a></li>
            <li class="breadcrumb-item"><a href="{% url 'birth_certificates_list' %}">Birth Certificates</a></li>
            <li class="breadcrumb-item active">{{ certificate.certificate_number }}</li>
        </ol>
    </nav>
</div>

<section class="section">
    <div class="row">
        <!-- Certificate Info -->
        <div class="col-lg-4">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-header bg-primary text-white">
                    <h6 style='color: white' class="mb-0"><i class="bi bi-award me-2"></i>Certificate Information</h6>
                </div>
                <div class="card-body">
                    <div class="text-center mb-3">
                        <div class="avatar avatar-xl bg-primary rounded-circle d-flex align-items-center justify-content-center mx-auto mb-2" style="width: 80px; height: 80px;">
                            <i class="bi bi-award text-white" style="font-size: 2.5rem;"></i>
                        </div>
                        <h5>{{ certificate.full_name }}</h5>
                        <span class="badge {% if certificate.is_verified %}bg-success{% else %}bg-warning{% endif %}">
                            {% if certificate.is_verified %}Verified{% else %}Pending Verification{% endif %}
                        </span>
                    </div>
                    <hr>
                    <div class="row g-2">
                        <div class="col-12">
                            <p><strong><i class="bi bi-hash me-2"></i>Certificate #:</strong><br>{{ certificate.certificate_number }}</p>
                        </div>
                        <div class="col-12">
                            <p><strong><i class="bi bi-123 me-2"></i>Serial Number:</strong><br>{{ certificate.serial_number }}</p>
                        </div>
                        <div class="col-12">
                            <p><strong><i class="bi bi-calendar me-2"></i>Date of Birth:</strong><br>{{ certificate.date_of_birth|date:"F d, Y" }}</p>
                        </div>
                        <div class="col-12">
                            <p><strong><i class="bi bi-geo-alt me-2"></i>Place of Birth:</strong><br>{{ certificate.place_of_birth }}</p>
                        </div>
                        <div class="col-12">
                            <p><strong><i class="bi bi-person-badge me-2"></i>Gender:</strong><br>{{ certificate.get_gender_display }}</p>
                        </div>
                        <div class="col-12">
                            <p><strong><i class="bi bi-calendar-check me-2"></i>Registration Date:</strong><br>{{ certificate.registration_date|date:"F d, Y" }}</p>
                        </div>
                    </div>
                    
                    <hr>
                    <div class="d-grid gap-2">
                        <a href="{% url 'birth_certificate_update' certificate.certificate_number %}" class="btn btn-primary">
                            <i class="bi bi-pencil me-2"></i>Edit Certificate
                        </a>
                        <form method="POST" action="{% url 'birth_certificate_delete' certificate.certificate_number %}" onsubmit="return confirm('Are you sure you want to delete this certificate?');" style="display: inline;">
                            {% csrf_token %}
                            <button type="submit" class="btn btn-outline-danger w-100">
                                <i class="bi bi-trash me-2"></i>Delete Certificate
                            </button>
                        </form>
                        <a href="{% url 'birth_certificates_list' %}" class="btn btn-outline-secondary">
                            <i class="bi bi-arrow-left me-2"></i>Back to List
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Detailed Information -->
        <div class="col-lg-8">
            <div class="row">
                <!-- Birth Location -->
                <div class="col-12">
                    <div class="card border-0 shadow-sm mb-3">
                        <div class="card-header bg-light">
                            <h6 class="mb-0"><i class="bi bi-geo me-2"></i>Birth Location</h6>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <p><strong>County:</strong> {{ certificate.county_of_birth.name }}</p>
                                    <p><strong>Sub County:</strong> {{ certificate.sub_county_of_birth.name }}</p>
                                    <p><strong>Division:</strong> {{ certificate.division_of_birth.name }}</p>
                                </div>
                                <div class="col-md-6">
                                    <p><strong>Location:</strong> {{ certificate.location_of_birth.name }}</p>
                                    <p><strong>Sub Location:</strong> {{ certificate.sub_location_of_birth.name }}</p>
                                    <p><strong>Village:</strong> {{ certificate.village_of_birth.name }}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Family Information -->
                <div class="col-12">
                    <div class="card border-0 shadow-sm mb-3">
                        <div class="card-header bg-light">
                            <h6 class="mb-0"><i class="bi bi-people me-2"></i>Family Information</h6>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <h6 class="text-muted">Father</h6>
                                    <p><strong>Name:</strong> {{ certificate.father_name|default:"Not provided" }}</p>
                                    <p><strong>ID Number:</strong> {{ certificate.father_id|default:"Not provided" }}</p>
                                    <p><strong>Nationality:</strong> {{ certificate.father_nationality }}</p>
                                </div>
                                <div class="col-md-6">
                                    <h6 class="text-muted">Mother</h6>
                                    <p><strong>Name:</strong> {{ certificate.mother_name|default:"Not provided" }}</p>
                                    <p><strong>ID Number:</strong> {{ certificate.mother_id|default:"Not provided" }}</p>
                                    <p><strong>Nationality:</strong> {{ certificate.mother_nationality }}</p>
                                </div>
                            </div>
                            {% if certificate.guardian_name %}
                            <hr>
                            <div class="row">
                                <div class="col-md-12">
                                    <h6 class="text-muted">Guardian Information</h6>
                                    <div class="row">
                                        <div class="col-md-4">
                                            <p><strong>Name:</strong> {{ certificate.guardian_name }}</p>
                                        </div>
                                        <div class="col-md-4">
                                            <p><strong>ID Number:</strong> {{ certificate.guardian_id|default:"Not provided" }}</p>
                                        </div>
                                        <div class="col-md-4">
                                            <p><strong>Relationship:</strong> {{ certificate.guardian_relationship|default:"Not specified" }}</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <!-- Registration Details -->
                <div class="col-12">
                    <div class="card border-0 shadow-sm mb-3">
                        <div class="card-header bg-light">
                            <h6 class="mb-0"><i class="bi bi-building me-2"></i>Registration Details</h6>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <p><strong>Issuing Office:</strong> {{ certificate.issuing_office }}</p>
                                    <p><strong>Registrar:</strong> {{ certificate.registrar_name }}</p>
                                    <p><strong>Registration Date:</strong> {{ certificate.registration_date|date:"F d, Y" }}</p>
                                </div>
                                <div class="col-md-6">
                                    <p><strong>Kenyan Born:</strong> 
                                        <span class="badge {% if certificate.is_kenyan_born %}bg-success{% else %}bg-warning{% endif %}">
                                            {% if certificate.is_kenyan_born %}Yes{% else %}No{% endif %}
                                        </span>
                                    </p>
                                    {% if not certificate.is_kenyan_born %}
                                    <p><strong>Naturalization Cert:</strong> {{ certificate.naturalization_cert|default:"Not provided" }}</p>
                                    <p><strong>Citizenship Date:</strong> {{ certificate.citizenship_acquired_date|date:"F d, Y"|default:"Not provided" }}</p>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Status Information -->
                <div class="col-12">
                    <div class="card border-0 shadow-sm mb-3">
                        <div class="card-header bg-light">
                            <h6 class="mb-0"><i class="bi bi-info-circle me-2"></i>Status Information</h6>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <p><strong>Active Status:</strong> 
                                        <span class="badge {% if certificate.is_active %}bg-success{% else %}bg-danger{% endif %}">
                                            {% if certificate.is_active %}Active{% else %}Inactive{% endif %}
                                        </span>
                                    </p>
                                    <p><strong>Verification Status:</strong> 
                                        <span class="badge {% if certificate.is_verified %}bg-success{% else %}bg-warning{% endif %}">
                                            {% if certificate.is_verified %}Verified{% else %}Pending{% endif %}
                                        </span>
                                    </p>
                                </div>
                                <div class="col-md-6">
                                    <p><strong>Created:</strong> {{ certificate.created_at|date:"F d, Y \a\\t g:i A" }}</p>
                                    <p><strong>Last Updated:</strong> {{ certificate.updated_at|date:"F d, Y \a\\t g:i A" }}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Related ID Applications -->
    <div class="row mt-4">
        <div class="col-12">
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-light">
                    <h6 class="mb-0"><i class="bi bi-card-list me-2"></i>Related ID Applications</h6>
                </div>
                <div class="card-body">
                    {% if certificate.idapplication_set.all %}
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead class="table-light">
                                <tr>
                                    <th>Application Number</th>
                                    <th>Applicant Name</th>
                                    <th>Type</th>
                                    <th>Status</th>
                                    <th>Created Date</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for application in certificate.idapplication_set.all %}
                                <tr>
                                    <td>{{ application.application_number }}</td>
                                    <td>{{ application.full_name }}</td>
                                    <td>
                                        <span class="badge {% if application.application_type == 'new' %}bg-success{% elif application.application_type == 'replacement' %}bg-warning{% else %}bg-info{% endif %}">
                                            {{ application.get_application_type_display }}
                                        </span>
                                    </td>
                                    <td>
                                        <span class="badge 
                                            {% if application.status == 'started' or application.status == 'documents_uploaded' %}bg-secondary
                                            {% elif application.status == 'chief_review' or application.status == 'do_review' %}bg-warning
                                            {% elif application.status == 'chief_approved' or application.status == 'do_approved' %}bg-success
                                            {% elif application.status == 'ready_for_collection' %}bg-info
                                            {% elif application.status == 'collected' %}bg-primary
                                            {% elif application.status == 'rejected' or application.status == 'cancelled' %}bg-danger
                                            {% else %}bg-light text-dark{% endif %}">
                                            {{ application.get_status_display }}
                                        </span>
                                    </td>
                                    <td>{{ application.created_at|date:"M d, Y" }}</td>
                                    <td>
                                        <a href="{% url 'applications_detail' application.application_id %}" class="btn btn-sm btn-outline-primary">
                                            <i class="bi bi-eye"></i>
                                        </a>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% else %}
                    <p class="text-muted text-center py-3">No ID applications found for this birth certificate.</p>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}